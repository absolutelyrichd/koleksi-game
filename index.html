<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koleksi Game</title>
    <!-- Memuat Tailwind CSS dari CDN untuk styling yang cepat dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Chart.js untuk diagram lingkaran -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Memuat Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Memuat Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables for Firebase (MANDATORY)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // Fallback Firebase configuration
        const fallbackFirebaseConfig = {
            apiKey: "AIzaSyAzJTL179V9bT-DfefZq9gcG8Tz88VzLmQ",
            authDomain: "koleksi-game.firebaseapp.com",
            projectId: "koleksi-game",
            storageBucket: "koleksi-game.firebasestorage.app",
            messagingSenderId: "222959670551",
            appId: "1:222959670551:web:048b1e2c4ef16b7bd31352",
            measurementId: "G-BYYCM7R4M8"
        };
        // Use provided firebase config or fallback if not defined/empty
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' && __firebase_config !== '{}' ? __firebase_config : JSON.stringify(fallbackFirebaseConfig));
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Global variables for game data and UI elements
        let games = [];
        let customPlatforms = [];
        let customStores = [];
        let customLocations = [];
        let customStatuses = [];
        let editingGameId = null;
        let currentPage = 1;
        const gamesPerPage = 9; // Changed from 6 to 9
        let gameStatusPieChart = null;
        let platformPieChart = null;
        let lokasiMentahanPieChart = null;
        let digitalPlatformPieChart = null; // New chart for Digital Platform
        let autoDownloadIntervalId = null;
        let currentAutoDownloadInterval = 5; // Default 5 minutes
        let userId = null; // User ID from Firebase Auth
        let isAuthReady = false; // Flag to indicate if auth state has been checked

        // Default options for dropdowns (not including 'manual' option)
        const defaultPlatforms = ['PC', 'PS', 'PS2', 'PS3'];
        const defaultStores = ['Steam', 'Epic Games', 'GOG']; // These are now Digital Platforms
        const defaultStatuses = ['Dimainkan', 'Belum Dimainkan', 'Selesai', 'Wishlist'];
        const defaultLokasiMentahanOptions = ['HDD Eksternal 4TB', 'HDD Eksternal 2TB'];

        // DOM element references
        const gameForm = document.getElementById('gameForm');
        const formTitle = document.getElementById('formTitle');
        const gameTitleInput = document.getElementById('gameTitle'); // Now a textarea
        const gamePlatformSelect = document.getElementById('gamePlatform');
        const manualPlatformInputContainer = document.getElementById('manualPlatformInputContainer');
        const manualGamePlatformInput = document.getElementById('manualGamePlatform');
        const gameStoreSelect = document.getElementById('gameStore'); // This is now Digital Platform select
        const manualStoreInputContainer = document.getElementById('manualStoreInputContainer');
        const manualGameStoreInput = document.getElementById('manualGameStore');
        const gameStatusSelect = document.getElementById('gameStatus');
        const lokasiMentahanSelect = document.getElementById('lokasiMentahan');
        const manualLokasiMentahanInputContainer = document.getElementById('manualLokasiMentahanInputContainer');
        const manualLokasiMentahanInput = document.getElementById('manualLokasiMentahan');
        const submitButton = document.getElementById('submitButton');
        const cancelEditButton = document.getElementById('cancelEditButton');
        const gameListContainer = document.getElementById('gameList');
        const searchGameInput = document.getElementById('searchGame');
        const filterStatusSelect = document.getElementById('filterStatus');
        const filterPlatformSelect = document.getElementById('filterPlatform');
        const filterDigitalPlatformSelect = document.getElementById('filterDigitalPlatform'); // New filter for Digital Platform
        const filterLokasiMentahanSelect = document.getElementById('filterLokasiMentahan');
        const sortGamesSelect = document.getElementById('sortGames');
        const noGamesMessage = document.getElementById('noGamesMessage');
        const gameStatusChartCanvas = document.getElementById('gameStatusChart');
        const platformChartCanvas = document.getElementById('platformChart');
        const lokasiMentahanChartCanvas = document.getElementById('lokasiMentahanChart');
        const digitalPlatformChartCanvas = document.getElementById('digitalPlatformChart'); // New chart canvas
        const gameStatusLegend = document.getElementById('gameStatusLegend');
        const platformLegend = document.getElementById('platformLegend');
        const lokasiMentahanLegend = document.getElementById('lokasiMentahanLegend');
        const digitalPlatformLegend = document.getElementById('digitalPlatformLegend'); // New legend
        const paginationControls = document.getElementById('paginationControls');
        const exportDataButton = document.getElementById('exportDataButton');
        const importDataButton = document.getElementById('importDataButton');
        const importFileInput = document.getElementById('importFileInput');
        const autoDownloadToggle = document.getElementById('autoDownloadToggle');
        const autoDownloadIntervalInput = document.getElementById('autoDownloadInterval');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = {
            'game-list': document.getElementById('game-list'),
            'statistics': document.getElementById('statistics'),
            'data-management': document.getElementById('data-management')
        };
        const platformOptionInput = document.getElementById('platformOptionInput');
        const addPlatformOptionButton = document.getElementById('addPlatformOptionButton');
        const currentPlatformOptionsList = document.getElementById('currentPlatformOptionsList');
        const storeOptionInput = document.getElementById('storeOptionInput'); // This is now Digital Platform option input
        const addStoreOptionButton = document.getElementById('addStoreOptionButton');
        const currentStoreOptionsList = document.getElementById('currentStoreOptionsList');
        const lokasiOptionInput = document.getElementById('lokasiOptionInput');
        const addLokasiOptionButton = document.getElementById('addLokasiOptionButton');
        const currentLokasiOptionsList = document.getElementById('currentLokasiOptionsList');
        const statusOptionInput = document.getElementById('statusOptionInput');
        const addStatusOptionButton = document.getElementById('addStatusOptionButton');
        const currentStatusOptionsList = document.getElementById('currentStatusOptionsList');

        const loginButton = document.getElementById('loginButton');
        const logoutButton = document.getElementById('logoutButton');
        const authStatusDiv = document.getElementById('authStatus');
        const userIdDisplay = document.getElementById('userIdDisplay');
        const mainContent = document.getElementById('mainContent');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const confirmModal = document.getElementById('confirmModal');
        const confirmMessage = document.getElementById('confirmMessage');
        const confirmYesBtn = document.getElementById('confirmYes');
        const confirmNoBtn = document.getElementById('confirmNo');
        const messageModal = document.getElementById('messageModal');
        const messageText = document.getElementById('messageText');
        const messageCloseBtn = document.getElementById('messageClose');
        const messageModalIcon = document.getElementById('messageModalIcon');
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const sidebar = document.getElementById('sidebar');

        // --- UI Utility Functions for Modals and Loading ---
        function showLoading(message) {
            loadingOverlay.classList.remove('hidden');
            document.getElementById('loadingMessage').textContent = message;
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        function displayMessage(message, type) {
            messageText.textContent = message;
            messageModalIcon.className = ''; // Clear previous icons
            switch (type) {
                case 'success':
                    messageModalIcon.classList.add('fas', 'fa-check-circle', 'text-green-500');
                    break;
                case 'error':
                    messageModalIcon.classList.add('fas', 'fa-exclamation-circle', 'text-red-500');
                    break;
                case 'info':
                    messageModalIcon.classList.add('fas', 'fa-info-circle', 'text-blue-500');
                    break;
                default:
                    messageModalIcon.classList.add('fas', 'fa-info-circle', 'text-gray-500');
            }
            messageModal.classList.remove('hidden');
        }

        function displayConfirmation(message, onConfirm) {
            confirmMessage.textContent = message;
            confirmModal.classList.remove('hidden');

            const handleYes = () => {
                onConfirm();
                confirmModal.classList.add('hidden');
                confirmYesBtn.removeEventListener('click', handleYes);
                confirmNoBtn.removeEventListener('click', handleNo);
            };
            const handleNo = () => {
                confirmModal.classList.add('hidden');
                confirmYesBtn.removeEventListener('click', handleYes);
                confirmNoBtn.removeEventListener('click', handleNo);
            };

            confirmYesBtn.addEventListener('click', handleYes);
            confirmNoBtn.addEventListener('click', handleNo);
        }

        // --- Firebase Authentication ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                authStatusDiv.textContent = `Masuk sebagai: ${user.displayName || user.email || 'Pengguna Anonim'}`;
                userIdDisplay.textContent = `ID Pengguna: ${userId}`;
                loginButton.classList.add('hidden');
                logoutButton.classList.remove('hidden');
                mainContent.classList.remove('hidden'); // Show main content
                displayMessage(`Berhasil masuk! ID Pengguna: ${userId}`, "success");
                await loadDataFromFirestore(); // Load data after successful login
            } else {
                userId = null;
                authStatusDiv.textContent = 'Belum masuk';
                userIdDisplay.textContent = '';
                loginButton.classList.remove('hidden');
                logoutButton.classList.add('hidden');
                mainContent.classList.add('hidden'); // Hide main content if not logged in
                games = []; // Clear local games if logged out
                customPlatforms = [];
                customStores = [];
                customLocations = [];
                customStatuses = [];
                renderAll(); // Re-render with empty data
                displayMessage("Anda telah keluar atau belum masuk. Data tidak akan disimpan.", "info");
            }
            isAuthReady = true; // Auth state has been checked
            hideLoading();
        });

        async function handleGoogleLogin() {
            showLoading("Masuk dengan Google...");
            try {
                await signInWithPopup(auth, provider);
                // User will be handled by onAuthStateChanged
            } catch (error) {
                console.error("Error signing in with Google:", error);
                displayMessage(`Gagal masuk dengan Google: ${error.message}`, "error");
                hideLoading();
            }
        }

        async function handleLogout() {
            showLoading("Keluar...");
            try {
                await signOut(auth);
                // User will be handled by onAuthStateChanged
            } catch (error) {
                console.error("Error signing out:", error);
                displayMessage(`Gagal keluar: ${error.message}`, "error");
                hideLoading();
            }
        }

        // --- Firebase Firestore Data Operations ---

        // Path helpers
        function getUserGamesCollectionRef() {
            if (!userId) {
                console.error("User ID not available for Firestore operations.");
                return null;
            }
            return collection(db, `artifacts/${appId}/users/${userId}/gameCollection`);
        }

        function getUserCustomOptionsDocRef() {
            if (!userId) {
                console.error("User ID not available for Firestore operations.");
                return null;
            }
            // Changed path to include a 'settings' subcollection to make the path even-segmented
            return doc(db, `artifacts/${appId}/users/${userId}/settings/customOptions`);
        }

        async function loadDataFromFirestore() {
            if (!userId) return;
            showLoading("Memuat data dari Firebase...");
            try {
                // Load games
                const gamesColRef = getUserGamesCollectionRef();
                if (gamesColRef) {
                    onSnapshot(gamesColRef, (snapshot) => {
                        games = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        currentPage = 1;
                        renderAll();
                        hideLoading();
                    }, (error) => {
                        console.error("Error listening to games collection:", error);
                        displayMessage(`Gagal memuat game: ${error.message}`, "error");
                        hideLoading();
                    });
                }

                // Load custom options
                const customOptionsDocRef = getUserCustomOptionsDocRef();
                if (customOptionsDocRef) {
                    onSnapshot(customOptionsDocRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            customPlatforms = data.platforms || [];
                            customStores = data.stores || [];
                            customLocations = data.locations || [];
                            customStatuses = data.statuses || [];
                        } else {
                            // If no custom options exist, initialize with empty arrays
                            customPlatforms = [];
                            customStores = [];
                            customLocations = [];
                            customStatuses = [];
                        }
                        updateAllDropdowns();
                        hideLoading();
                    }, (error) => {
                        console.error("Error listening to custom options:", error);
                        displayMessage(`Gagal memuat opsi kustom: ${error.message}`, "error");
                        hideLoading();
                    });
                }
            } catch (error) {
                console.error("Error loading data from Firestore:", error);
                displayMessage(`Gagal memuat data dari Firebase: ${error.message}`, "error");
                hideLoading();
            }
        }

        async function saveGameToFirestore(gameData) {
            if (!userId) {
                displayMessage("Anda harus masuk untuk menyimpan game.", "error");
                return false;
            }
            showLoading("Menyimpan game...");
            try {
                const gamesColRef = getUserGamesCollectionRef();
                if (!gamesColRef) return false;

                if (gameData.id) { // Update existing game
                    const gameDocRef = doc(gamesColRef, gameData.id);
                    await setDoc(gameDocRef, gameData, { merge: true });
                    displayMessage("Game berhasil diperbarui!", "success");
                } else { // Add new game
                    const newGame = { ...gameData };
                    const docRef = await addDoc(gamesColRef, newGame);
                    newGame.id = docRef.id; // Get the ID generated by Firestore
                    displayMessage("Game berhasil ditambahkan!", "success");
                }
                hideLoading();
                return true;
            } catch (error) {
                console.error("Error saving game to Firestore:", error);
                displayMessage(`Gagal menyimpan game: ${error.message}`, "error");
                hideLoading();
                return false;
            }
        }

        async function deleteGameFromFirestore(gameId) {
            if (!userId) {
                displayMessage("Anda harus masuk untuk menghapus game.", "error");
                return false;
            }
            showLoading("Menghapus game...");
            try {
                const gamesColRef = getUserGamesCollectionRef();
                if (!gamesColRef) return false;

                const gameDocRef = doc(gamesColRef, gameId);
                await deleteDoc(gameDocRef);
                displayMessage("Game berhasil dihapus!", "success");
                hideLoading();
                return true;
            } catch (error) {
                console.error("Error deleting game from Firestore:", error);
                displayMessage(`Gagal menghapus game: ${error.message}`, "error");
                hideLoading();
                return false;
            }
        }

        async function saveCustomDropdownOptionsToFirestore() {
            if (!userId) {
                displayMessage("Anda harus masuk untuk menyimpan opsi kustom.", "error");
                return false;
            }
            showLoading("Menyimpan opsi kustom...");
            try {
                const customOptionsDocRef = getUserCustomOptionsDocRef();
                if (!customOptionsDocRef) return false;

                await setDoc(customOptionsDocRef, {
                    platforms: customPlatforms,
                    stores: customStores,
                    locations: customLocations,
                    statuses: customStatuses
                });
                displayMessage("Opsi kustom berhasil disimpan!", "success");
                hideLoading();
                return true;
            } catch (error) {
                console.error("Error saving custom options to Firestore:", error);
                displayMessage(`Gagal menyimpan opsi kustom: ${error.message}`, "error");
                hideLoading();
                return false;
            }
        }

        // --- Generic function to populate a select element ---
        function populateSelect(selectElement, optionsArray, includeManual = true, addPlaceholder = false) {
            selectElement.innerHTML = '';
            if (addPlaceholder) {
                const placeholderOption = document.createElement('option');
                placeholderOption.value = "";
                placeholderOption.textContent = "Pilih Lokasi"; // Placeholder for Lokasi dropdown
                selectElement.appendChild(placeholderOption);
            }
            optionsArray.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                selectElement.appendChild(opt);
            });
            if (includeManual) {
                const manualOpt = document.createElement('option');
                manualOpt.value = 'manual';
                manualOpt.textContent = 'Lainnya (input manual)';
                selectElement.appendChild(manualOpt);
            }
        }

        // --- Render custom options list in Data Management tab ---
        function renderCustomOptionsList(optionsArray, listElement) {
            listElement.innerHTML = '';
            if (optionsArray.length === 0) {
                listElement.innerHTML = '<li class="text-gray-500">Belum ada opsi kustom.</li>';
                return;
            }
            optionsArray.forEach(option => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center py-1';
                li.innerHTML = `
                    <span>${option}</span>
                    <button data-value="${option}" class="delete-custom-option-button text-red-500 hover:text-red-700 text-sm font-bold ml-2">Hapus</button>
                `;
                listElement.appendChild(li);
            });
        }

        // --- Update all relevant dropdowns with default and custom options ---
        function updateAllDropdowns() {
            // Combine default and custom options for each category
            const allPlatforms = [...new Set([...defaultPlatforms, ...customPlatforms])].sort();
            const allStores = [...new Set([...defaultStores, ...customStores])].sort(); // These are now Digital Platforms
            const allStatuses = [...new Set([...defaultStatuses, ...customStatuses])].sort();
            const allLokasiMentahan = [...new Set([...defaultLokasiMentahanOptions, ...customLocations])].sort();

            // Populate game form dropdowns
            populateSelect(gamePlatformSelect, allPlatforms, true);
            populateSelect(gameStoreSelect, allStores, true); // Populate Digital Platform select
            populateSelect(gameStatusSelect, allStatuses, false); // Status dropdown doesn't have 'manual'
            populateSelect(lokasiMentahanSelect, allLokasiMentahan, true, true); // Lokasi has placeholder and manual

            // Populate filter dropdowns (they don't need 'manual' option)
            populateSelect(filterPlatformSelect, ['all', ...allPlatforms], false); // 'all' option handled
            populateSelect(filterDigitalPlatformSelect, ['all', ...allStores], false); // New filter for Digital Platform
            populateSelect(filterStatusSelect, ['all', ...allStatuses], false);
            populateSelect(filterLokasiMentahanSelect, ['all', ...allLokasiMentahan], false);

            // Render custom options lists in data management tab
            renderCustomOptionsList(customPlatforms, currentPlatformOptionsList);
            renderCustomOptionsList(customStores, currentStoreOptionsList);
            renderCustomOptionsList(customLocations, currentLokasiOptionsList);
            renderCustomOptionsList(customStatuses, currentStatusOptionsList);

            // Restore previously selected values for filters if available
            filterPlatformSelect.value = filterPlatformSelect.dataset.currentValue || 'all';
            filterDigitalPlatformSelect.value = filterDigitalPlatformSelect.dataset.currentValue || 'all'; // For Digital Platform filter
            filterLokasiMentahanSelect.value = filterLokasiMentahanSelect.dataset.currentValue || 'all';
            filterStatusSelect.value = filterStatusSelect.dataset.currentValue || 'all'; // Also for status filter
        }

        // --- Generic add custom option logic ---
        async function handleAddCustomOption(inputElement, customArray, listElement) {
            if (!userId) {
                displayMessage("Anda harus masuk untuk menambahkan opsi kustom.", "error");
                return;
            }
            const newItem = inputElement.value.trim();
            if (newItem && !customArray.includes(newItem)) {
                customArray.push(newItem);
                await saveCustomDropdownOptionsToFirestore();
                displayMessage(`${newItem} berhasil ditambahkan!`, "success");
                inputElement.value = '';
                updateAllDropdowns(); // Re-populate all dropdowns and lists
            } else if (customArray.includes(newItem)) {
                displayMessage(`"${newItem}" sudah ada.`, "error");
            } else {
                displayMessage("Harap masukkan nama opsi.", "error");
            }
        }

        // --- Generic delete custom option logic ---
        async function handleDeleteCustomOption(event, customArray) {
            if (!userId) {
                displayMessage("Anda harus masuk untuk menghapus opsi kustom.", "error");
                return;
            }
            const itemToDelete = event.target.dataset.value;
            displayConfirmation(`Apakah Anda yakin ingin menghapus "${itemToDelete}"?`, async () => {
                const index = customArray.indexOf(itemToDelete);
                if (index > -1) {
                    customArray.splice(index, 1);
                    await saveCustomDropdownOptionsToFirestore();
                    displayMessage(`"${itemToDelete}" berhasil dihapus.`, "success");
                    updateAllDropdowns(); // Re-populate all dropdowns and lists
                }
            });
        }
        
        // Fungsi untuk merender (menampilkan) daftar game, menerapkan filter dan pengurutan
        function renderGames() {
            gameListContainer.innerHTML = ''; // Mengosongkan daftar yang ada
            const searchTerm = searchGameInput.value.toLowerCase();
            const filterStatus = filterStatusSelect.value;
            const filterPlatform = filterPlatformSelect.value;
            const filterDigitalPlatform = filterDigitalPlatformSelect.value; // Get digital platform filter value
            const filterLokasiMentahan = filterLokasiMentahanSelect.value;
            const sortOption = sortGamesSelect.value;
            // Filter game berdasarkan pencarian dan status
            let filteredGames = games.filter(game => {
                const matchesSearch = game.title.toLowerCase().includes(searchTerm) || game.platform.toLowerCase().includes(searchTerm) || game.store.toLowerCase().includes(searchTerm);
                const matchesStatus = filterStatus === 'all' || game.status === filterStatus;
                const matchesPlatform = filterPlatform === 'all' || game.platform === filterPlatform;
                const matchesDigitalPlatform = filterDigitalPlatform === 'all' || game.store === filterDigitalPlatform; // Match digital platform
                const matchesLokasiMentahan = filterLokasiMentahan === 'all' || game.lokasiMentahan === filterLokasiMentahan;
                return matchesSearch && matchesStatus && matchesPlatform && matchesDigitalPlatform && matchesLokasiMentahan;
            });
            // Urutkan game
            filteredGames.sort((a, b) => {
                switch (sortOption) {
                    case 'title-asc': return a.title.localeCompare(b.title);
                    case 'title-desc': return b.title.localeCompare(a.title);
                    case 'platform-asc': return a.platform.localeCompare(b.platform);
                    case 'status-asc': return a.status.localeCompare(b.status);
                    default: return 0;
                }
            });
            // Terapkan pagination
            const totalPages = Math.ceil(filteredGames.length / gamesPerPage);
            const startIndex = (currentPage - 1) * gamesPerPage;
            const endIndex = startIndex + gamesPerPage;
            const gamesToDisplay = filteredGames.slice(startIndex, endIndex);

            if (gamesToDisplay.length === 0) {
                noGamesMessage.classList.remove('hidden');
                gameListContainer.classList.remove('grid', 'grid-cols-1', 'sm:grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-3', 'gap-4'); // Added lg:grid-cols-3
                gameListContainer.classList.add('space-y-4'); // Tambahkan kembali space-y-4 untuk konsistensi jika kosong
            } else {
                noGamesMessage.classList.add('hidden');
                gameListContainer.classList.remove('space-y-4');
                gameListContainer.classList.add('grid', 'grid-cols-1', 'sm:grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-3', 'gap-4'); // Added lg:grid-cols-3
                gamesToDisplay.forEach(game => {
                    const gameItem = document.createElement('div');
                    gameItem.className = 'bg-white p-4 rounded-lg shadow-sm flex flex-col items-start justify-between border border-gray-200 hover:shadow-md transition-shadow';
                    gameItem.innerHTML = `
                    <div class="flex-grow w-full mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">${game.title}</h3>
                        <p class="text-sm text-gray-600 mt-1">Platform: ${game.platform}</p>
                        <p class="text-sm text-gray-600">Platform Digital: ${game.store}</p>
                        <p class="text-sm text-gray-600">Lokasi: ${game.lokasiMentahan || '-'}</p>
                        <span class="inline-block px-3 py-1 mt-2 text-xs font-medium rounded-full ${getStatusColorClass(game.status)}">
                            ${game.status}
                        </span>
                    </div>
                    <div class="flex space-x-2 mt-auto"> <!-- mt-auto mendorong tombol ke bagian bawah -->
                        <button data-id="${game.id}" class="edit-button bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-3 rounded-md transition duration-300 ease-in-out transform hover:scale-105">
                            Edit
                        </button>
                        <button data-id="${game.id}" class="delete-button bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-md transition duration-300 ease-in-out transform hover:scale-105">
                            Hapus
                        </button>
                    </div>
                `;
                    gameListContainer.appendChild(gameItem);
                });
            }
            // Render pagination controls
            renderPaginationControls(totalPages);
        }

        // Fungsi untuk merender kontrol paginasi
        function renderPaginationControls(totalPages) {
            paginationControls.innerHTML = ''; // Kosongkan kontrol yang ada
            if (totalPages <= 1) {
                return; // Jangan tampilkan paginasi jika hanya ada satu halaman atau kurang
            }
            // Tombol Sebelumnya
            const prevButton = document.createElement('button');
            prevButton.textContent = 'Sebelumnya';
            prevButton.className = `px-4 py-2 rounded-md transition duration-300 ${currentPage === 1 ? 'bg-gray-300 text-gray-600 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-700 text-white'}`;
            prevButton.disabled = currentPage === 1;
            prevButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderGames();
                }
            });
            paginationControls.appendChild(prevButton);
            // Nomor Halaman
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.className = `px-4 py-2 mx-1 rounded-md transition duration-300 ${currentPage === i ? 'bg-indigo-800 text-white font-bold' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`;
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    renderGames();
                });
                paginationControls.appendChild(pageButton);
            }
            // Tombol Selanjutnya
            const nextButton = document.createElement('button');
            nextButton.textContent = 'Selanjutnya';
            nextButton.className = `px-4 py-2 rounded-md transition duration-300 ${currentPage === totalPages ? 'bg-gray-300 text-gray-600 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-700 text-white'}`;
            nextButton.disabled = currentPage === totalPages;
            nextButton.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderGames();
                }
            });
            paginationControls.appendChild(nextButton);
        }

        // --- Chart.js Logic ---
        function renderCharts() {
            // Check if there are any games to display charts for
            if (games.length === 0) {
                // If no games, clear existing charts and display a message
                if (gameStatusPieChart) { gameStatusPieChart.destroy(); gameStatusPieChart = null; }
                if (platformPieChart) { platformPieChart.destroy(); platformPieChart = null; }
                if (lokasiMentahanPieChart) { lokasiMentahanPieChart.destroy(); lokasiMentahanPieChart = null; }
                if (digitalPlatformPieChart) { digitalPlatformPieChart.destroy(); digitalPlatformPieChart = null; }
                // Display messages or hide chart containers if needed
                gameStatusChartCanvas.style.display = 'none';
                platformChartCanvas.style.display = 'none';
                lokasiMentahanChartCanvas.style.display = 'none';
                digitalPlatformChartCanvas.style.display = 'none';
                return;
            }

            // Show canvas elements if charts are being rendered
            gameStatusChartCanvas.style.display = 'block';
            platformChartCanvas.style.display = 'block';
            lokasiMentahanChartCanvas.style.display = 'block';
            digitalPlatformChartCanvas.style.display = 'block';

            // Data for charts
            const statusCounts = games.reduce((acc, game) => {
                acc[game.status] = (acc[game.status] || 0) + 1;
                return acc;
            }, {});
            const platformCounts = games.reduce((acc, game) => {
                acc[game.platform] = (acc[game.platform] || 0) + 1;
                return acc;
            }, {});
            const lokasiMentahanCounts = games.reduce((acc, game) => {
                const lokasi = game.lokasiMentahan || 'Tidak Ditetapkan';
                acc[lokasi] = (acc[lokasi] || 0) + 1;
                return acc;
            }, {});
            const digitalPlatformCounts = games.reduce((acc, game) => {
                acc[game.store] = (acc[game.store] || 0) + 1;
                return acc;
            }, {});

            // Generate a set of consistent colors
            const getChartColors = (count) => {
                const colors = [
                    '#4F46E5', '#6366F1', '#818CF8', '#A5B4FC', '#C7D2FE',
                    '#E0E7FF', '#9333EA', '#A855F7', '#C084FC', '#D8B4FE'
                ];
                return Array.from({ length: count }, (_, i) => colors[i % colors.length]);
            };

            const updatePieChart = (chart, canvas, data, labels, chartTitle) => {
                // Destroy previous chart instance if it exists
                if (chart) {
                    chart.destroy();
                }
                const ctx = canvas.getContext('2d');
                const backgroundColors = getChartColors(labels.length);

                chart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColors,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false, // Hide built-in legend
                                position: 'bottom',
                            },
                            title: {
                                display: true,
                                text: chartTitle,
                                font: {
                                    size: 16
                                },
                                color: '#374151'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.raw !== null) {
                                            label += `${context.raw} game (${(context.raw / games.length * 100).toFixed(1)}%)`;
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
                return chart;
            };
            
            // Create the charts
            gameStatusPieChart = updatePieChart(
                gameStatusPieChart,
                gameStatusChartCanvas,
                Object.values(statusCounts),
                Object.keys(statusCounts),
                'Distribusi Status Game'
            );
            
            platformPieChart = updatePieChart(
                platformPieChart,
                platformChartCanvas,
                Object.values(platformCounts),
                Object.keys(platformCounts),
                'Distribusi Platform'
            );
            
            lokasiMentahanPieChart = updatePieChart(
                lokasiMentahanPieChart,
                lokasiMentahanChartCanvas,
                Object.values(lokasiMentahanCounts),
                Object.keys(lokasiMentahanCounts),
                'Distribusi Lokasi Mentahan'
            );
            
            digitalPlatformPieChart = updatePieChart(
                digitalPlatformPieChart,
                digitalPlatformChartCanvas,
                Object.values(digitalPlatformCounts),
                Object.keys(digitalPlatformCounts),
                'Distribusi Platform Digital'
            );

            // Generate custom legends
            const generateLegend = (chartInstance, legendElement) => {
                legendElement.innerHTML = '';
                const labels = chartInstance.data.labels;
                const colors = chartInstance.data.datasets[0].backgroundColor;
                const data = chartInstance.data.datasets[0].data;

                if (labels.length === 0) {
                    legendElement.innerHTML = '<p class="text-gray-500">Tidak ada data untuk ditampilkan.</p>';
                    return;
                }

                labels.forEach((label, index) => {
                    const legendItem = document.createElement('div');
                    legendItem.className = 'flex items-center text-sm mb-1';
                    legendItem.innerHTML = `
                        <span class="inline-block w-4 h-4 rounded-full mr-2" style="background-color: ${colors[index]}"></span>
                        <span>${label}: <strong>${data[index]}</strong> game</span>
                    `;
                    legendElement.appendChild(legendItem);
                });
            };

            generateLegend(gameStatusPieChart, gameStatusLegend);
            generateLegend(platformPieChart, platformLegend);
            generateLegend(lokasiMentahanPieChart, lokasiMentahanLegend);
            generateLegend(digitalPlatformPieChart, digitalPlatformLegend);
        }

        function getStatusColorClass(status) {
            switch (status) {
                case 'Dimainkan':
                    return 'bg-blue-200 text-blue-800';
                case 'Belum Dimainkan':
                    return 'bg-gray-200 text-gray-800';
                case 'Selesai':
                    return 'bg-green-200 text-green-800';
                case 'Wishlist':
                    return 'bg-purple-200 text-purple-800';
                default:
                    return 'bg-gray-200 text-gray-800';
            }
        }

        function renderAll() {
            renderGames();
            renderCharts();
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', async () => {
            // Initial call to update dropdowns
            updateAllDropdowns();
            // Initial render
            renderAll();
        });

        // Add event listeners for the modal and loading functions
        messageCloseBtn.addEventListener('click', () => messageModal.classList.add('hidden'));
        loginButton.addEventListener('click', handleGoogleLogin);
        logoutButton.addEventListener('click', handleLogout);

        // Sidebar mobile menu functionality
        mobileMenuButton.addEventListener('click', () => {
            sidebar.classList.remove('-translate-x-full');
        });
        document.getElementById('mobileMenuCloseButton').addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
        });

        // Tab functionality
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and hide all content
                tabButtons.forEach(btn => btn.classList.remove('bg-gray-700'));
                Object.values(tabContents).forEach(content => content.classList.add('hidden'));

                // Add active class to clicked button and show its content
                button.classList.add('bg-gray-700');
                const tabId = button.dataset.tab;
                tabContents[tabId].classList.remove('hidden');
            });
        });

        // Initial tab to be active
        document.getElementById('tab-game-list').classList.add('bg-gray-700');
        tabContents['game-list'].classList.remove('hidden');

        // Form Submission
        gameForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const gameTitle = gameTitleInput.value.trim();
            const gamePlatform = gamePlatformSelect.value === 'manual' ? manualGamePlatformInput.value.trim() : gamePlatformSelect.value;
            const gameStore = gameStoreSelect.value === 'manual' ? manualGameStoreInput.value.trim() : gameStoreSelect.value;
            const gameStatus = gameStatusSelect.value;
            const lokasiMentahan = lokasiMentahanSelect.value === 'manual' ? manualLokasiMentahanInput.value.trim() : lokasiMentahanSelect.value;

            if (!gameTitle || !gamePlatform || !gameStore || !gameStatus || !lokasiMentahan) {
                displayMessage("Semua kolom harus diisi!", "error");
                return;
            }

            const newGameData = {
                title: gameTitle,
                platform: gamePlatform,
                store: gameStore,
                status: gameStatus,
                lokasiMentahan: lokasiMentahan,
                timestamp: new Date().toISOString()
            };

            if (editingGameId) {
                newGameData.id = editingGameId;
                await saveGameToFirestore(newGameData);
            } else {
                await saveGameToFirestore(newGameData);
            }

            gameForm.reset();
            gameTitleInput.value = '';
            gamePlatformSelect.value = '';
            gameStoreSelect.value = '';
            gameStatusSelect.value = '';
            lokasiMentahanSelect.value = '';
            manualPlatformInputContainer.classList.add('hidden');
            manualStoreInputContainer.classList.add('hidden');
            manualLokasiMentahanInputContainer.classList.add('hidden');
            editingGameId = null;
            formTitle.textContent = "Tambahkan Game Baru";
            submitButton.innerHTML = '<i class="fas fa-plus mr-2"></i>Tambah';
            cancelEditButton.classList.add('hidden');
        });

        // Handle manual input field visibility
        gamePlatformSelect.addEventListener('change', (e) => {
            if (e.target.value === 'manual') {
                manualPlatformInputContainer.classList.remove('hidden');
                manualGamePlatformInput.focus();
            } else {
                manualPlatformInputContainer.classList.add('hidden');
            }
        });
        gameStoreSelect.addEventListener('change', (e) => {
            if (e.target.value === 'manual') {
                manualStoreInputContainer.classList.remove('hidden');
                manualGameStoreInput.focus();
            } else {
                manualStoreInputContainer.classList.add('hidden');
            }
        });
        lokasiMentahanSelect.addEventListener('change', (e) => {
            if (e.target.value === 'manual') {
                manualLokasiMentahanInputContainer.classList.remove('hidden');
                manualLokasiMentahanInput.focus();
            } else {
                manualLokasiMentahanInputContainer.classList.add('hidden');
            }
        });

        // Search, Filter, Sort Event Listeners
        searchGameInput.addEventListener('input', () => {
            currentPage = 1;
            renderGames();
        });
        filterStatusSelect.addEventListener('change', (e) => {
            filterStatusSelect.dataset.currentValue = e.target.value;
            currentPage = 1;
            renderGames();
        });
        filterPlatformSelect.addEventListener('change', (e) => {
            filterPlatformSelect.dataset.currentValue = e.target.value;
            currentPage = 1;
            renderGames();
        });
        filterDigitalPlatformSelect.addEventListener('change', (e) => {
            filterDigitalPlatformSelect.dataset.currentValue = e.target.value;
            currentPage = 1;
            renderGames();
        });
        filterLokasiMentahanSelect.addEventListener('change', (e) => {
            filterLokasiMentahanSelect.dataset.currentValue = e.target.value;
            currentPage = 1;
            renderGames();
        });
        sortGamesSelect.addEventListener('change', () => {
            renderGames();
        });

        // Edit and Delete buttons in game list
        gameListContainer.addEventListener('click', async (e) => {
            const id = e.target.dataset.id;
            if (e.target.classList.contains('edit-button')) {
                const gameToEdit = games.find(game => game.id === id);
                if (gameToEdit) {
                    editingGameId = id;
                    gameTitleInput.value = gameToEdit.title;
                    
                    // Set dropdown values or show manual input
                    gamePlatformSelect.value = defaultPlatforms.includes(gameToEdit.platform) || customPlatforms.includes(gameToEdit.platform) ? gameToEdit.platform : 'manual';
                    if (gamePlatformSelect.value === 'manual') {
                        manualPlatformInputContainer.classList.remove('hidden');
                        manualGamePlatformInput.value = gameToEdit.platform;
                    } else {
                        manualPlatformInputContainer.classList.add('hidden');
                    }

                    gameStoreSelect.value = defaultStores.includes(gameToEdit.store) || customStores.includes(gameToEdit.store) ? gameToEdit.store : 'manual';
                    if (gameStoreSelect.value === 'manual') {
                        manualStoreInputContainer.classList.remove('hidden');
                        manualGameStoreInput.value = gameToEdit.store;
                    } else {
                        manualStoreInputContainer.classList.add('hidden');
                    }

                    gameStatusSelect.value = gameToEdit.status;
                    
                    lokasiMentahanSelect.value = defaultLokasiMentahanOptions.includes(gameToEdit.lokasiMentahan) || customLocations.includes(gameToEdit.lokasiMentahan) ? gameToEdit.lokasiMentahan : 'manual';
                    if (lokasiMentahanSelect.value === 'manual') {
                        manualLokasiMentahanInputContainer.classList.remove('hidden');
                        manualLokasiMentahanInput.value = gameToEdit.lokasiMentahan;
                    } else {
                        manualLokasiMentahanInputContainer.classList.add('hidden');
                    }

                    formTitle.textContent = `Edit Game: ${gameToEdit.title}`;
                    submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>Simpan Perubahan';
                    cancelEditButton.classList.remove('hidden');
                }
            } else if (e.target.classList.contains('delete-button')) {
                displayConfirmation("Apakah Anda yakin ingin menghapus game ini?", () => {
                    deleteGameFromFirestore(id);
                });
            }
        });

        cancelEditButton.addEventListener('click', () => {
            editingGameId = null;
            gameForm.reset();
            gameTitleInput.value = '';
            gamePlatformSelect.value = '';
            gameStoreSelect.value = '';
            gameStatusSelect.value = '';
            lokasiMentahanSelect.value = '';
            manualPlatformInputContainer.classList.add('hidden');
            manualStoreInputContainer.classList.add('hidden');
            manualLokasiMentahanInputContainer.classList.add('hidden');
            formTitle.textContent = "Tambahkan Game Baru";
            submitButton.innerHTML = '<i class="fas fa-plus mr-2"></i>Tambah';
            cancelEditButton.classList.add('hidden');
        });

        // Data Management Events
        addPlatformOptionButton.addEventListener('click', () => handleAddCustomOption(platformOptionInput, customPlatforms, currentPlatformOptionsList));
        currentPlatformOptionsList.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-custom-option-button')) {
                handleDeleteCustomOption(e, customPlatforms);
            }
        });

        addStoreOptionButton.addEventListener('click', () => handleAddCustomOption(storeOptionInput, customStores, currentStoreOptionsList));
        currentStoreOptionsList.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-custom-option-button')) {
                handleDeleteCustomOption(e, customStores);
            }
        });

        addLokasiOptionButton.addEventListener('click', () => handleAddCustomOption(lokasiOptionInput, customLocations, currentLokasiOptionsList));
        currentLokasiOptionsList.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-custom-option-button')) {
                handleDeleteCustomOption(e, customLocations);
            }
        });
        
        addStatusOptionButton.addEventListener('click', () => handleAddCustomOption(statusOptionInput, customStatuses, currentStatusOptionsList));
        currentStatusOptionsList.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-custom-option-button')) {
                handleDeleteCustomOption(e, customStatuses);
            }
        });
    </script>
</head>
<body class="bg-gray-100 font-sans antialiased text-gray-900">
    <!-- Overlay for loading state -->
    <div id="loadingOverlay" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl flex items-center space-x-4">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
            <p id="loadingMessage" class="text-gray-700 font-medium">Memuat...</p>
        </div>
    </div>
    <!-- Modal for confirmation -->
    <div id="confirmModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
            <p id="confirmMessage" class="text-gray-800 text-lg mb-4 text-center"></p>
            <div class="flex justify-center space-x-4">
                <button id="confirmYes" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-md transition duration-300">Ya</button>
                <button id="confirmNo" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md transition duration-300">Tidak</button>
            </div>
        </div>
    </div>
    <!-- Modal for messages -->
    <div id="messageModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full relative">
            <button id="messageClose" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <div class="flex items-center space-x-3 mb-4">
                <i id="messageModalIcon" class="text-2xl"></i>
                <p id="messageText" class="text-gray-800 font-semibold"></p>
            </div>
        </div>
    </div>
    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar -->
        <div id="sidebar" class="fixed inset-y-0 left-0 w-64 bg-gray-800 text-white p-6 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out z-40">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold">Koleksi Game</h2>
                <button id="mobileMenuCloseButton" class="text-white md:hidden">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p class="text-gray-400 text-sm mb-4" id="userIdDisplay"></p>
            <nav>
                <ul class="space-y-2">
                    <li><button id="tab-game-list" class="tab-button w-full text-left flex items-center space-x-2 p-3 rounded-lg hover:bg-gray-600 transition-colors duration-200" data-tab="game-list">
                        <i class="fas fa-gamepad"></i>
                        <span>Daftar Game</span>
                    </button></li>
                    <li><button id="tab-statistics" class="tab-button w-full text-left flex items-center space-x-2 p-3 rounded-lg hover:bg-gray-600 transition-colors duration-200" data-tab="statistics">
                        <i class="fas fa-chart-pie"></i>
                        <span>Statistik Koleksi Game</span>
                    </button></li>
                    <li><button id="tab-data-management" class="tab-button w-full text-left flex items-center space-x-2 p-3 rounded-lg hover:bg-gray-600 transition-colors duration-200" data-tab="data-management">
                        <i class="fas fa-database"></i>
                        <span>Manajemen Data & Opsi Kustom</span>
                    </button></li>
                </ul>
            </nav>
            <div class="mt-auto pt-6 border-t border-gray-700">
                <div id="authStatus" class="text-sm text-gray-400 mb-2"></div>
                <button id="loginButton" class="w-full text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300">
                    Masuk dengan Google
                </button>
                <button id="logoutButton" class="w-full text-center bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 hidden">
                    Keluar
                </button>
            </div>
        </div>
        <!-- Main Content -->
        <div id="mainContent" class="flex-1 flex flex-col overflow-hidden ml-0 md:ml-64 hidden">
            <header class="bg-white shadow p-4 flex items-center justify-between md:hidden">
                <button id="mobileMenuButton" class="text-gray-500 hover:text-gray-900">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <h1 class="text-xl font-bold">Koleksi Game</h1>
            </header>
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                <!-- Content Area -->
                <div class="max-w-7xl mx-auto">
                    <!-- Tab Content -->
                    <div id="game-list" class="tab-content">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <!-- Form to Add/Edit Game -->
                            <div class="md:col-span-1 bg-white p-6 rounded-lg shadow-lg h-fit sticky top-6">
                                <h3 id="formTitle" class="text-xl font-bold text-gray-800 mb-4">Tambahkan Game Baru</h3>
                                <form id="gameForm">
                                    <div class="mb-4">
                                        <label for="gameTitle" class="block text-sm font-medium text-gray-700">Judul Game</label>
                                        <input type="text" id="gameTitle" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Contoh: The Witcher 3">
                                    </div>
                                    <div class="mb-4">
                                        <label for="gamePlatform" class="block text-sm font-medium text-gray-700">Platform</label>
                                        <select id="gamePlatform" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></select>
                                        <div id="manualPlatformInputContainer" class="mt-2 hidden">
                                            <input type="text" id="manualGamePlatform" class="block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm" placeholder="Masukkan nama platform">
                                        </div>
                                    </div>
                                    <div class="mb-4">
                                        <label for="gameStore" class="block text-sm font-medium text-gray-700">Platform Digital</label>
                                        <select id="gameStore" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></select>
                                        <div id="manualStoreInputContainer" class="mt-2 hidden">
                                            <input type="text" id="manualGameStore" class="block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm" placeholder="Masukkan nama platform digital">
                                        </div>
                                    </div>
                                    <div class="mb-4">
                                        <label for="gameStatus" class="block text-sm font-medium text-gray-700">Status</label>
                                        <select id="gameStatus" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></select>
                                    </div>
                                    <div class="mb-4">
                                        <label for="lokasiMentahan" class="block text-sm font-medium text-gray-700">Lokasi Mentahan</label>
                                        <select id="lokasiMentahan" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></select>
                                        <div id="manualLokasiMentahanInputContainer" class="mt-2 hidden">
                                            <input type="text" id="manualLokasiMentahan" class="block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm" placeholder="Masukkan lokasi mentahan">
                                        </div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button type="submit" id="submitButton" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">
                                            <i class="fas fa-plus mr-2"></i>Tambah
                                        </button>
                                        <button type="button" id="cancelEditButton" class="hidden flex-1 bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">
                                            Batal Edit
                                        </button>
                                    </div>
                                </form>
                            </div>
                            <!-- Game List & Filters -->
                            <div class="md:col-span-2 space-y-6">
                                <!-- Filter and Sort Section -->
                                <div class="bg-white p-6 rounded-lg shadow-lg">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">Daftar Game</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                        <div class="col-span-full md:col-span-2 lg:col-span-1">
                                            <label for="searchGame" class="sr-only">Cari Game</label>
                                            <input type="text" id="searchGame" placeholder="Cari berdasarkan judul, platform..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                        </div>
                                        <div>
                                            <label for="filterPlatform" class="sr-only">Filter Platform</label>
                                            <select id="filterPlatform" data-current-value="all" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                                <option value="all">Semua Platform</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="filterDigitalPlatform" class="sr-only">Filter Platform Digital</label>
                                            <select id="filterDigitalPlatform" data-current-value="all" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                                <option value="all">Semua Platform Digital</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="filterStatus" class="sr-only">Filter Status</label>
                                            <select id="filterStatus" data-current-value="all" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                                <option value="all">Semua Status</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="filterLokasiMentahan" class="sr-only">Filter Lokasi</label>
                                            <select id="filterLokasiMentahan" data-current-value="all" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                                <option value="all">Semua Lokasi</option>
                                            </select>
                                        </div>
                                        <div class="col-span-full md:col-span-2 lg:col-span-1">
                                            <label for="sortGames" class="sr-only">Urutkan Game</label>
                                            <select id="sortGames" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                                <option value="title-asc">Judul (A-Z)</option>
                                                <option value="title-desc">Judul (Z-A)</option>
                                                <option value="platform-asc">Platform</option>
                                                <option value="status-asc">Status</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <!-- Game List -->
                                <div id="gameList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4">
                                    <!-- Game items will be rendered here -->
                                </div>
                                <div id="noGamesMessage" class="hidden text-center text-gray-500 py-10">
                                    <i class="fas fa-info-circle text-4xl mb-4"></i>
                                    <p class="text-lg">Belum ada game yang ditambahkan.</p>
                                </div>
                                <!-- Pagination -->
                                <div id="paginationControls" class="flex justify-center items-center mt-6 space-x-2">
                                    <!-- Pagination buttons will be rendered here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="statistics" class="tab-content hidden">
                        <div class="bg-white p-6 rounded-lg shadow-lg">
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">Statistik Koleksi Game</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Chart 1: Game Status -->
                                <div class="bg-gray-50 p-4 rounded-lg shadow-inner flex flex-col justify-between">
                                    <h4 class="text-lg font-semibold text-gray-700 text-center mb-4">Distribusi Status Game</h4>
                                    <div class="flex-grow flex items-center justify-center min-h-[250px]">
                                        <canvas id="gameStatusChart" class="w-full max-w-sm"></canvas>
                                    </div>
                                    <div id="gameStatusLegend" class="mt-4 flex flex-wrap justify-center gap-2"></div>
                                </div>

                                <!-- Chart 2: Platform -->
                                <div class="bg-gray-50 p-4 rounded-lg shadow-inner flex flex-col justify-between">
                                    <h4 class="text-lg font-semibold text-gray-700 text-center mb-4">Distribusi Platform</h4>
                                    <div class="flex-grow flex items-center justify-center min-h-[250px]">
                                        <canvas id="platformChart" class="w-full max-w-sm"></canvas>
                                    </div>
                                    <div id="platformLegend" class="mt-4 flex flex-wrap justify-center gap-2"></div>
                                </div>

                                <!-- Chart 3: Lokasi Mentahan -->
                                <div class="bg-gray-50 p-4 rounded-lg shadow-inner flex flex-col justify-between">
                                    <h4 class="text-lg font-semibold text-gray-700 text-center mb-4">Distribusi Lokasi Mentahan</h4>
                                    <div class="flex-grow flex items-center justify-center min-h-[250px]">
                                        <canvas id="lokasiMentahanChart" class="w-full max-w-sm"></canvas>
                                    </div>
                                    <div id="lokasiMentahanLegend" class="mt-4 flex flex-wrap justify-center gap-2"></div>
                                </div>

                                <!-- Chart 4: Digital Platform -->
                                <div class="bg-gray-50 p-4 rounded-lg shadow-inner flex flex-col justify-between">
                                    <h4 class="text-lg font-semibold text-gray-700 text-center mb-4">Distribusi Platform Digital</h4>
                                    <div class="flex-grow flex items-center justify-center min-h-[250px]">
                                        <canvas id="digitalPlatformChart" class="w-full max-w-sm"></canvas>
                                    </div>
                                    <div id="digitalPlatformLegend" class="mt-4 flex flex-wrap justify-center gap-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="data-management" class="tab-content hidden">
                        <div class="bg-white p-6 rounded-lg shadow-lg">
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">Manajemen Data & Opsi Kustom</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

                                <!-- Opsi Kustom Platform -->
                                <div class="p-4 bg-gray-50 rounded-lg shadow-inner">
                                    <h3 class="text-lg font-bold text-gray-700 mb-3">Platform</h3>
                                    <div class="flex flex-col sm:flex-row gap-2 mb-2">
                                        <input type="text" id="platformOptionInput" placeholder="Nama Platform Baru"
                                               class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                        <button id="addPlatformOptionButton"
                                                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">
                                            Tambah
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <h4 class="text-md font-semibold text-gray-700 mb-2">Opsi kustom aktif:</h4>
                                        <ul id="currentPlatformOptionsList" class="list-disc list-inside text-sm text-gray-600 space-y-1">
                                            <!-- Custom statuses will be rendered here -->
                                        </ul>
                                    </div>
                                </div>

                                <!-- Opsi Kustom Digital Platform -->
                                <div class="p-4 bg-gray-50 rounded-lg shadow-inner">
                                    <h3 class="text-lg font-bold text-gray-700 mb-3">Platform Digital</h3>
                                    <div class="flex flex-col sm:flex-row gap-2 mb-2">
                                        <input type="text" id="storeOptionInput" placeholder="Nama Platform Digital Baru"
                                               class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                        <button id="addStoreOptionButton"
                                                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">
                                            Tambah
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <h4 class="text-md font-semibold text-gray-700 mb-2">Opsi kustom aktif:</h4>
                                        <ul id="currentStoreOptionsList" class="list-disc list-inside text-sm text-gray-600 space-y-1">
                                            <!-- Custom statuses will be rendered here -->
                                        </ul>
                                    </div>
                                </div>

                                <!-- Opsi Kustom Lokasi Mentahan -->
                                <div class="p-4 bg-gray-50 rounded-lg shadow-inner">
                                    <h3 class="text-lg font-bold text-gray-700 mb-3">Lokasi Mentahan</h3>
                                    <div class="flex flex-col sm:flex-row gap-2 mb-2">
                                        <input type="text" id="lokasiOptionInput" placeholder="Nama Lokasi Baru"
                                               class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                        <button id="addLokasiOptionButton"
                                                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">
                                            Tambah
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <h4 class="text-md font-semibold text-gray-700 mb-2">Opsi kustom aktif:</h4>
                                        <ul id="currentLokasiOptionsList" class="list-disc list-inside text-sm text-gray-600 space-y-1">
                                            <!-- Custom statuses will be rendered here -->
                                        </ul>
                                    </div>
                                </div>

                                <!-- Opsi Kustom Status -->
                                <div class="p-4 bg-gray-50 rounded-lg shadow-inner">
                                    <h3 class="text-lg font-bold text-gray-700 mb-3">Status</h3>
                                    <div class="flex flex-col sm:flex-row gap-2 mb-2">
                                        <input type="text" id="statusOptionInput" placeholder="Nama Status Baru"
                                               class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                        <button id="addStatusOptionButton"
                                                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">
                                            Tambah
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <h4 class="text-md font-semibold text-gray-700 mb-2">Opsi kustom aktif:</h4>
                                        <ul id="currentStatusOptionsList" class="list-disc list-inside text-sm text-gray-600 space-y-1">
                                            <!-- Custom statuses will be rendered here -->
                                        </ul>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
</body>
</html>
