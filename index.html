<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dasbor Koleksi Game</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js for Statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #f8fafc; /* slate-50 */
        }
        .tab-active {
            background-color: #334155; /* slate-700 */
            color: #f8fafc; /* slate-50 */
        }
        .tab-inactive {
            background-color: transparent;
            color: #94a3b8; /* slate-400 */
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; /* slate-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; /* slate-600 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* slate-500 */
        }
        .pagination-button {
            min-width: 40px;
        }
        .pagination-button.active {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md bg-slate-800 rounded-2xl shadow-2xl p-8 text-center">
            <h1 class="text-3xl font-bold text-white mb-2">Dasbor Koleksi Game</h1>
            <p class="text-slate-400 mb-8">Kelola dan lacak semua game favorit Anda di satu tempat.</p>
            <button id="login-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition duration-300">
                <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"/><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"/><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.021,35.591,44,30.138,44,24C44,22.659,43.862,21.35,43.611,20.083z"/></svg>
                Masuk dengan Google
            </button>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="app-screen" class="hidden">
        <div class="relative min-h-screen md:flex">
            <!-- Mobile Menu Backdrop -->
            <div id="mobile-menu-backdrop" class="fixed inset-0 bg-black/50 z-20 md:hidden hidden"></div>
            
            <!-- Sidebar -->
            <aside id="sidebar" class="fixed inset-y-0 left-0 bg-slate-800 w-64 p-6 flex flex-col z-30 transform transition-transform duration-300 md:relative md:translate-x-0 -translate-x-full">
                <div class="flex-grow">
                    <div class="flex items-center justify-between mb-8">
                        <h1 class="text-2xl font-bold text-white">Koleksi Game</h1>
                        <button id="close-sidebar-button" class="md:hidden text-slate-400 hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <nav id="tabs" class="flex flex-col space-y-2">
                         <button data-tab="tab-list" class="tab-button tab-active flex items-center py-2 px-4 rounded-lg transition duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M2 6a2 2 0 012-2h12a2 2 0 012 2v1H2V6zM2 9v7a2 2 0 002 2h12a2 2 0 002-2V9H2zm4-4a1 1 0 100-2 1 1 0 000 2zM8 5a1 1 0 100-2 1 1 0 000 2z"/></svg>
                            Daftar Game
                        </button>
                        <button data-tab="tab-stats" class="tab-button tab-inactive flex items-center py-2 px-4 rounded-lg transition duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/></svg>
                            Statistik
                        </button>
                        <button data-tab="tab-bulk" class="tab-button tab-inactive flex items-center py-2 px-4 rounded-lg transition duration-200">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
                            Aksi Masal
                        </button>
                        <button data-tab="tab-manage" class="tab-button tab-inactive flex items-center py-2 px-4 rounded-lg transition duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                            Manajemen Data
                        </button>
                    </nav>
                </div>
                <div>
                    <div id="user-profile" class="flex items-center space-x-3 border-t border-slate-700 pt-4 mb-4">
                        <img id="user-photo" src="https://placehold.co/40x40/e2e8f0/e2e8f0" alt="User Photo" class="w-10 h-10 rounded-full">
                        <div>
                            <p id="user-name" class="font-semibold text-sm text-white">Guest User</p>
                            <p id="user-id" class="text-xs text-slate-400 truncate"></p>
                            <button id="logout-button" class="text-xs text-red-400 hover:text-red-300">Keluar</button>
                        </div>
                    </div>
                    <p class="text-xs text-slate-500 text-center">Â© 2024 RichD</p>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 p-4 md:p-8 overflow-y-auto">
                <!-- Header Mobile -->
                 <header class="md:hidden flex items-center justify-between mb-6">
                    <button id="open-sidebar-button" class="text-slate-200 hover:text-white">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-white">Koleksi Game</h1>
                    <div></div> <!-- Spacer -->
                </header>

                <!-- Tab: Daftar Game -->
                <div id="tab-list" class="tab-content">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4">
                        <h2 class="text-2xl sm:text-3xl font-bold">Daftar Game</h2>
                        <button id="add-game-button" class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center transition duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                            Tambah Game
                        </button>
                    </div>
                    <!-- Filter Section -->
                    <div class="bg-slate-800 p-4 md:p-6 rounded-xl shadow-lg mb-6">
                        <h3 class="font-bold text-xl mb-4">Filter Game</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <input id="filter-title" type="text" placeholder="Filter berdasarkan judul..." class="bg-slate-700 border border-slate-600 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                            <select id="filter-platform" class="bg-slate-700 border border-slate-600 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                <option value="">Semua Platform</option>
                                <option>Steam</option><option>Epic</option><option>GOG</option><option>PCSX</option><option>Crack</option>
                            </select>
                            <select id="filter-location" class="bg-slate-700 border border-slate-600 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                <option value="">Semua Lokasi</option>
                                <option>HDD Eksternal 2TB</option><option>HDD Eksternal 4TB</option><option>Internal SSD</option><option>Belum Install</option>
                            </select>
                            <select id="filter-status" class="bg-slate-700 border border-slate-600 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                <option value="">Semua Status</option>
                                <option>Dimainkan</option><option>Belum dimainkan</option><option>Selesai</option>
                            </select>
                        </div>
                     </div>
                    <!-- Game Table -->
                    <div class="bg-slate-800 rounded-xl shadow-lg overflow-x-auto">
                        <table class="w-full text-left min-w-[640px]">
                            <thead class="bg-slate-700">
                                <tr>
                                    <th class="p-4 w-12"><input type="checkbox" id="select-all-checkbox" class="rounded bg-slate-600 border-slate-500"></th>
                                    <th class="p-4 font-semibold">Judul Game</th>
                                    <th class="p-4 font-semibold">Platform</th>
                                    <th class="p-4 font-semibold">Lokasi</th>
                                    <th class="p-4 font-semibold">Status</th>
                                    <th class="p-4 font-semibold">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="game-list-body">
                                <!-- Game items will be injected here by JS -->
                                <tr><td colspan="6" class="text-center p-8 text-slate-400">Memuat data game...</td></tr>
                            </tbody>
                        </table>
                    </div>
                     <!-- Pagination -->
                    <div id="pagination-container" class="flex justify-center items-center mt-6 space-x-1 sm:space-x-2"></div>
                </div>

                <!-- Tab: Statistik -->
                <div id="tab-stats" class="tab-content hidden">
                     <h2 class="text-2xl sm:text-3xl font-bold mb-6">Statistik Game</h2>
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                            <h3 class="font-bold text-xl text-center mb-4">Game per Platform</h3>
                            <div class="relative h-64 w-full mx-auto" style="max-width: 280px;">
                                <canvas id="platform-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                            <h3 class="font-bold text-xl text-center mb-4">Game per Lokasi</h3>
                            <div class="relative h-64 w-full mx-auto" style="max-width: 280px;">
                                <canvas id="location-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-slate-800 p-6 rounded-xl shadow-lg col-span-1 lg:col-span-2">
                             <h3 class="font-bold mb-4 text-xl text-center">Status Permainan</h3>
                            <div class="relative h-64 w-full mx-auto" style="max-width: 800px;">
                                <canvas id="status-chart"></canvas>
                            </div>
                        </div>
                     </div>
                </div>

                <!-- Tab: Aksi Masal -->
                <div id="tab-bulk" class="tab-content hidden">
                     <h2 class="text-2xl sm:text-3xl font-bold mb-6">Aksi Masal</h2>
                     <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                        <h3 class="font-bold text-xl mb-4">Tindakan untuk Game Terpilih</h3>
                        <p id="selection-info" class="text-slate-400 mb-4">Pilih game dari 'Daftar Game' untuk melakukan aksi masal. Centang di header tabel hanya memilih item di halaman saat ini.</p>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button id="bulk-edit-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center transition duration-300 disabled:bg-blue-800 disabled:cursor-not-allowed" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                                Edit Game Terpilih
                            </button>
                            <button id="bulk-delete-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center transition duration-300 disabled:bg-red-800 disabled:cursor-not-allowed" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                                Hapus Game Terpilih
                            </button>
                        </div>
                     </div>
                </div>

                <!-- Tab: Manajemen Data -->
                <div id="tab-manage" class="tab-content hidden">
                    <h2 class="text-2xl sm:text-3xl font-bold mb-6">Manajemen Data</h2>
                    <div class="bg-slate-800 p-6 rounded-xl shadow-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="font-bold text-xl mb-2">Ekspor Data</h3>
                                <p class="text-slate-400 mb-4">Unduh semua koleksi game Anda sebagai file JSON.</p>
                                <button id="download-json-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition duration-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                    Unduh JSON
                                </button>
                            </div>
                            <div>
                                <h3 class="font-bold text-xl mb-2">Impor Data</h3>
                                <p class="text-slate-400 mb-4">Impor game dari file JSON yang sebelumnya diekspor.</p>
                                <div class="flex items-center">
                                    <input type="file" id="json-file-input" accept=".json" class="hidden">
                                    <button id="import-json-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition duration-300 mr-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" transform="rotate(180 10 10)" /></svg>
                                        Pilih File
                                    </button>
                                    <span id="file-name-span" class="text-slate-400 text-sm">Belum ada file dipilih</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal: Add/Edit Game -->
    <div id="game-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-xl shadow-2xl p-6 sm:p-8 w-full max-w-lg relative transform scale-95 transition-transform duration-300">
            <h3 id="modal-title" class="text-xl sm:text-2xl font-bold mb-4">Tambah Game Baru</h3>
            <form id="game-form">
                <div class="mb-4">
                    <label for="game-title" class="block text-slate-300 mb-2">Judul Game</label>
                    <input type="text" id="game-title" required class="w-full p-2 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="mb-4">
                    <label for="game-platform" class="block text-slate-300 mb-2">Platform</label>
                    <select id="game-platform" required class="w-full p-2 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <!-- Options will be added dynamically by JS -->
                    </select>
                </div>
                <div class="mb-4">
                    <label for="game-location" class="block text-slate-300 mb-2">Lokasi</label>
                    <select id="game-location" required class="w-full p-2 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <!-- Options will be added dynamically by JS -->
                    </select>
                </div>
                <div class="mb-4">
                    <label for="game-status" class="block text-slate-300 mb-2">Status</label>
                    <select id="game-status" required class="w-full p-2 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <!-- Options will be added dynamically by JS -->
                    </select>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancel-game-button" class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Batal</button>
                    <button type="submit" id="save-game-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Simpan</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal: Bulk Edit Game -->
    <div id="bulk-edit-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-xl shadow-2xl p-6 sm:p-8 w-full max-w-lg relative transform scale-95 transition-transform duration-300">
            <h3 class="text-xl sm:text-2xl font-bold mb-4">Edit Masal Game</h3>
            <p id="bulk-edit-info" class="text-slate-400 mb-4"></p>
            <form id="bulk-edit-form">
                <div class="mb-4">
                    <label for="bulk-edit-platform" class="block text-slate-300 mb-2">Platform</label>
                    <select id="bulk-edit-platform" class="w-full p-2 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Pilih Platform (abaikan jika tidak ingin mengubah)</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="bulk-edit-location" class="block text-slate-300 mb-2">Lokasi</label>
                    <select id="bulk-edit-location" class="w-full p-2 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Pilih Lokasi (abaikan jika tidak ingin mengubah)</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="bulk-edit-status" class="block text-slate-300 mb-2">Status</label>
                    <select id="bulk-edit-status" class="w-full p-2 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Pilih Status (abaikan jika tidak ingin mengubah)</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancel-bulk-edit-button" class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Batal</button>
                    <button type="submit" id="save-bulk-edit-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Simpan Perubahan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Confirmation -->
    <div id="confirm-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-xl shadow-2xl p-6 w-full max-w-sm relative">
            <h3 class="text-xl font-bold mb-4 text-white">Konfirmasi</h3>
            <p id="confirm-message" class="text-slate-300 mb-6">Apakah Anda yakin ingin melakukan tindakan ini?</p>
            <div class="flex justify-end space-x-2">
                <button id="cancel-confirm" class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Batal</button>
                <button id="confirm-action" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Hapus</button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 hidden">
        <div id="toast-message" class="bg-green-600 text-white px-6 py-3 rounded-lg shadow-xl font-medium">
            Game berhasil ditambahkan!
        </div>
    </div>

    <!-- Firestore -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, query, where, getDocs, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase config is now provided as a global variable
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let app;
        let db;
        let auth;
        let currentUser;
        let gameItems = [];
        let platforms = ["Steam", "Epic", "GOG", "PCSX", "Crack"];
        let locations = ["HDD Eksternal 2TB", "HDD Eksternal 4TB", "Internal SSD", "Belum Install"];
        let statuses = ["Dimainkan", "Belum dimainkan", "Selesai"];
        let currentPage = 1;
        const gamesPerPage = 10;
        let allGames = [];
        let filteredGames = [];
        let platformChart, locationChart, statusChart;
        let selectedGameIds = new Set();
        let currentConfirmAction = null;

        // UI Elements
        const loginScreen = document.getElementById('login-screen');
        const appScreen = document.getElementById('app-screen');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const userProfile = document.getElementById('user-profile');
        const userName = document.getElementById('user-name');
        const userPhoto = document.getElementById('user-photo');
        const userIdElem = document.getElementById('user-id');

        const tabsContainer = document.getElementById('tabs');
        const tabList = document.getElementById('tab-list');
        const tabStats = document.getElementById('tab-stats');
        const tabBulk = document.getElementById('tab-bulk');
        const tabManage = document.getElementById('tab-manage');

        const addGameButton = document.getElementById('add-game-button');
        const gameModal = document.getElementById('game-modal');
        const bulkEditModal = document.getElementById('bulk-edit-modal');
        const gameForm = document.getElementById('game-form');
        const gameTitleInput = document.getElementById('game-title');
        const gamePlatformSelect = document.getElementById('game-platform');
        const gameLocationSelect = document.getElementById('game-location');
        const gameStatusSelect = document.getElementById('game-status');
        const modalTitle = document.getElementById('modal-title');
        const saveGameButton = document.getElementById('save-game-button');
        const cancelGameButton = document.getElementById('cancel-game-button');
        const gameListBody = document.getElementById('game-list-body');
        const selectAllCheckbox = document.getElementById('select-all-checkbox');
        const paginationContainer = document.getElementById('pagination-container');

        const bulkEditButton = document.getElementById('bulk-edit-button');
        const bulkDeleteButton = document.getElementById('bulk-delete-button');
        const selectionInfo = document.getElementById('selection-info');
        const bulkEditInfo = document.getElementById('bulk-edit-info');
        const bulkEditForm = document.getElementById('bulk-edit-form');
        const bulkEditPlatformSelect = document.getElementById('bulk-edit-platform');
        const bulkEditLocationSelect = document.getElementById('bulk-edit-location');
        const bulkEditStatusSelect = document.getElementById('bulk-edit-status');
        const cancelBulkEditButton = document.getElementById('cancel-bulk-edit-button');
        const saveBulkEditButton = document.getElementById('save-bulk-edit-button');

        const confirmModal = document.getElementById('confirm-modal');
        const confirmMessage = document.getElementById('confirm-message');
        const cancelConfirmButton = document.getElementById('cancel-confirm');
        const confirmActionButton = document.getElementById('confirm-action');

        const filterTitleInput = document.getElementById('filter-title');
        const filterPlatformSelect = document.getElementById('filter-platform');
        const filterLocationSelect = document.getElementById('filter-location');
        const filterStatusSelect = document.getElementById('filter-status');

        const downloadJsonButton = document.getElementById('download-json-button');
        const importJsonButton = document.getElementById('import-json-button');
        const jsonFileInput = document.getElementById('json-file-input');
        const fileNameSpan = document.getElementById('file-name-span');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');

        const openSidebarButton = document.getElementById('open-sidebar-button');
        const closeSidebarButton = document.getElementById('close-sidebar-button');
        const sidebar = document.getElementById('sidebar');
        const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');

        const modalElements = [gameModal, bulkEditModal, confirmModal];

        // Functions
        function showToast(message, isError = false) {
            toastMessage.textContent = message;
            toastMessage.classList.remove('bg-green-600', 'bg-red-600');
            toastMessage.classList.add(isError ? 'bg-red-600' : 'bg-green-600');
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        function showModal(modal) {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.querySelector('div:first-child').classList.remove('scale-95');
                modal.querySelector('div:first-child').classList.add('scale-100');
            }, 50);
        }

        function hideModal(modal) {
            modal.querySelector('div:first-child').classList.remove('scale-100');
            modal.querySelector('div:first-child').classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        
        function showConfirm(message, actionCallback) {
            confirmMessage.textContent = message;
            currentConfirmAction = actionCallback;
            showModal(confirmModal);
        }

        function setupTabListeners() {
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.replace('tab-active', 'tab-inactive'));
                    button.classList.replace('tab-inactive', 'tab-active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                    document.getElementById(button.dataset.tab).classList.remove('hidden');

                    if (button.dataset.tab === 'tab-stats') {
                        updateCharts();
                    } else if (button.dataset.tab === 'tab-bulk') {
                        updateBulkButtons();
                        updateSelectionInfo();
                    }
                });
            });
        }
        
        function updateBulkButtons() {
            const hasSelection = selectedGameIds.size > 0;
            bulkDeleteButton.disabled = !hasSelection;
            bulkEditButton.disabled = !hasSelection;
        }

        function updateSelectionInfo() {
            const totalSelected = selectedGameIds.size;
            selectionInfo.textContent = totalSelected > 0 
                ? `Anda telah memilih ${totalSelected} game.` 
                : `Pilih game dari 'Daftar Game' untuk melakukan aksi masal. Centang di header tabel hanya memilih item di halaman saat ini.`;
        }
        
        // This function sets up the real-time listener for the user's games
        function setupRealtimeListener() {
            if (!db || !currentUser) {
                console.error("Firestore atau pengguna tidak tersedia.");
                return;
            }
            const gamesCollectionRef = collection(db, `artifacts/${appId}/users/${currentUser.uid}/userGames`);
            onSnapshot(gamesCollectionRef, (snapshot) => {
                allGames = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                applyFiltersAndRender();
                updateCharts();
            }, (error) => {
                console.error("Error listening to Firestore: ", error);
                showToast("Gagal memuat data game. Silakan coba lagi.", true);
            });
        }
        
        function applyFiltersAndRender() {
            filteredGames = allGames.filter(game => {
                const titleMatch = filterTitleInput.value ? game.title.toLowerCase().includes(filterTitleInput.value.toLowerCase()) : true;
                const platformMatch = filterPlatformSelect.value ? game.platform === filterPlatformSelect.value : true;
                const locationMatch = filterLocationSelect.value ? game.location === filterLocationSelect.value : true;
                const statusMatch = filterStatusSelect.value ? game.status === filterStatusSelect.value : true;
                return titleMatch && platformMatch && locationMatch && statusMatch;
            });
            renderGameList(filteredGames);
        }

        function renderGameList(games) {
            gameListBody.innerHTML = '';
            const startIndex = (currentPage - 1) * gamesPerPage;
            const endIndex = startIndex + gamesPerPage;
            const gamesOnPage = games.slice(startIndex, endIndex);

            if (games.length === 0) {
                gameListBody.innerHTML = `<tr><td colspan="6" class="text-center p-8 text-slate-400">Tidak ada game yang ditemukan.</td></tr>`;
            } else {
                 gamesOnPage.forEach(game => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-slate-700 hover:bg-slate-700 transition duration-150';
                    row.innerHTML = `
                        <td class="p-4"><input type="checkbox" data-id="${game.id}" class="game-checkbox rounded bg-slate-600 border-slate-500" ${selectedGameIds.has(game.id) ? 'checked' : ''}></td>
                        <td class="p-4 font-semibold">${game.title}</td>
                        <td class="p-4 text-slate-400">${game.platform}</td>
                        <td class="p-4 text-slate-400">${game.location}</td>
                        <td class="p-4">
                             <span class="px-2 py-1 rounded-full text-xs font-medium ${game.status === 'Dimainkan' ? 'bg-blue-500' : game.status === 'Selesai' ? 'bg-green-500' : 'bg-yellow-500'} text-white">
                                ${game.status}
                            </span>
                        </td>
                        <td class="p-4">
                            <button data-id="${game.id}" class="edit-game-button text-indigo-400 hover:text-indigo-300 mr-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                            </button>
                            <button data-id="${game.id}" class="delete-game-button text-red-400 hover:text-red-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                            </button>
                        </td>
                    `;
                    gameListBody.appendChild(row);
                });
            }

            // Add event listeners for new buttons
            document.querySelectorAll('.edit-game-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const gameId = e.currentTarget.dataset.id;
                    const gameToEdit = allGames.find(g => g.id === gameId);
                    if (gameToEdit) {
                        openGameModal(gameToEdit);
                    }
                });
            });

            document.querySelectorAll('.delete-game-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const gameId = e.currentTarget.dataset.id;
                    showConfirm("Apakah Anda yakin ingin menghapus game ini?", async () => {
                        await deleteGame(gameId);
                        hideModal(confirmModal);
                    });
                });
            });

            // Update bulk checkboxes
            document.querySelectorAll('.game-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const gameId = e.target.dataset.id;
                    if (e.target.checked) {
                        selectedGameIds.add(gameId);
                    } else {
                        selectedGameIds.delete(gameId);
                    }
                    updateSelectAllCheckbox();
                    updateBulkButtons();
                    updateSelectionInfo();
                });
            });

            // Update select all checkbox state
            updateSelectAllCheckbox();
            renderPagination(games.length);
        }

        function updateSelectAllCheckbox() {
            const gameCheckboxes = document.querySelectorAll('.game-checkbox');
            const checkedCount = document.querySelectorAll('.game-checkbox:checked').length;
            const hasGames = gameCheckboxes.length > 0;
            selectAllCheckbox.checked = hasGames && checkedCount === gameCheckboxes.length;
            selectAllCheckbox.indeterminate = hasGames && checkedCount > 0 && checkedCount < gameCheckboxes.length;
            selectAllCheckbox.disabled = !hasGames;
        }

        function renderPagination(totalGames) {
            paginationContainer.innerHTML = '';
            const totalPages = Math.ceil(totalGames / gamesPerPage);
            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.className = `pagination-button bg-slate-700 text-slate-300 hover:bg-slate-600 font-semibold py-2 px-4 rounded-lg transition duration-200 ${i === currentPage ? 'active' : ''}`;
                button.addEventListener('click', () => {
                    currentPage = i;
                    applyFiltersAndRender();
                });
                paginationContainer.appendChild(button);
            }
        }
        
        function updateCharts() {
            if (!allGames.length) return;

            const platformCounts = {};
            const locationCounts = {};
            const statusCounts = {};

            platforms.forEach(p => platformCounts[p] = 0);
            locations.forEach(l => locationCounts[l] = 0);
            statuses.forEach(s => statusCounts[s] = 0);

            allGames.forEach(game => {
                platformCounts[game.platform]++;
                locationCounts[game.location]++;
                statusCounts[game.status]++;
            });

            const platformData = {
                labels: Object.keys(platformCounts),
                datasets: [{
                    data: Object.values(platformCounts),
                    backgroundColor: ['#4f46e5', '#3b82f6', '#10b981', '#ef4444', '#f97316'],
                }]
            };

            const locationData = {
                labels: Object.keys(locationCounts),
                datasets: [{
                    data: Object.values(locationCounts),
                    backgroundColor: ['#6366f1', '#a855f7', '#ec4899', '#facc15'],
                }]
            };
            
            const statusData = {
                 labels: Object.keys(statusCounts),
                 datasets: [{
                     label: 'Jumlah Game',
                     data: Object.values(statusCounts),
                     backgroundColor: ['#3b82f6', '#facc15', '#10b981'], // Dimainkan, Belum Dimainkan, Selesai
                 }]
            };

            if (platformChart) platformChart.destroy();
            platformChart = new Chart(document.getElementById('platform-chart'), {
                type: 'pie',
                data: platformData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: 'white' } } }
                }
            });

            if (locationChart) locationChart.destroy();
            locationChart = new Chart(document.getElementById('location-chart'), {
                type: 'pie',
                data: locationData,
                 options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: 'white' } } }
                }
            });
            
            if (statusChart) statusChart.destroy();
            statusChart = new Chart(document.getElementById('status-chart'), {
                type: 'bar',
                data: statusData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: 'white' },
                            grid: { color: '#475569' }
                        },
                        x: {
                            ticks: { color: 'white' },
                            grid: { color: '#475569' }
                        }
                    }
                }
            });
        }
        
        async function deleteGame(gameId) {
            try {
                if (!currentUser) throw new Error("Anda harus masuk untuk menghapus game.");
                const gameRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/userGames`, gameId);
                await deleteDoc(gameRef);
                showToast("Game berhasil dihapus.");
                selectedGameIds.delete(gameId); // Update selection after delete
            } catch (error) {
                console.error("Error deleting game: ", error);
                showToast(`Gagal menghapus game: ${error.message}`, true);
            }
        }
        
        async function bulkDeleteGames() {
            try {
                if (!currentUser) throw new Error("Anda harus masuk untuk menghapus game.");
                if (selectedGameIds.size === 0) throw new Error("Tidak ada game yang dipilih.");

                const batch = writeBatch(db);
                selectedGameIds.forEach(gameId => {
                    const gameRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/userGames`, gameId);
                    batch.delete(gameRef);
                });

                await batch.commit();
                showToast(`${selectedGameIds.size} game berhasil dihapus.`);
                selectedGameIds.clear();
                updateBulkButtons();
                updateSelectionInfo();
            } catch (error) {
                console.error("Error bulk deleting games: ", error);
                showToast(`Gagal menghapus game: ${error.message}`, true);
            }
        }

        async function bulkEditGames(updates) {
             try {
                if (!currentUser) throw new Error("Anda harus masuk untuk mengedit game.");
                if (selectedGameIds.size === 0) throw new Error("Tidak ada game yang dipilih.");
                
                const batch = writeBatch(db);
                selectedGameIds.forEach(gameId => {
                    const gameRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/userGames`, gameId);
                    batch.update(gameRef, updates);
                });

                await batch.commit();
                showToast(`${selectedGameIds.size} game berhasil diupdate.`);
                selectedGameIds.clear();
                updateBulkButtons();
                updateSelectionInfo();
            } catch (error) {
                console.error("Error bulk editing games: ", error);
                showToast(`Gagal mengupdate game: ${error.message}`, true);
            }
        }

        function populateFormOptions() {
            const selects = [gamePlatformSelect, gameLocationSelect, gameStatusSelect, bulkEditPlatformSelect, bulkEditLocationSelect, bulkEditStatusSelect];
            const data = [platforms, locations, statuses, platforms, locations, statuses];

            selects.forEach((select, index) => {
                // Clear existing options, except for the placeholder for bulk edit
                if (index < 3) { // Game Modal
                    select.innerHTML = '';
                    data[index].forEach(item => {
                        const option = document.createElement('option');
                        option.value = item;
                        option.textContent = item;
                        select.appendChild(option);
                    });
                } else { // Bulk Edit Modal
                    select.innerHTML = select.innerHTML = `<option value="">Pilih ${['Platform', 'Lokasi', 'Status'][index-3]} (abaikan jika tidak ingin mengubah)</option>`;
                    data[index].forEach(item => {
                        const option = document.createElement('option');
                        option.value = item;
                        option.textContent = item;
                        select.appendChild(option);
                    });
                }
            });
        }
        
        function openGameModal(game = null) {
            gameForm.reset();
            modalTitle.textContent = game ? "Edit Game" : "Tambah Game Baru";
            saveGameButton.textContent = game ? "Simpan Perubahan" : "Tambah Game";
            saveGameButton.dataset.gameId = game ? game.id : '';

            if (game) {
                gameTitleInput.value = game.title;
                gamePlatformSelect.value = game.platform;
                gameLocationSelect.value = game.location;
                gameStatusSelect.value = game.status;
            }
            showModal(gameModal);
        }

        function openBulkEditModal() {
            bulkEditForm.reset();
            const selectedCount = selectedGameIds.size;
            bulkEditInfo.textContent = `Anda akan mengedit ${selectedCount} game yang terpilih.`;
            showModal(bulkEditModal);
        }
        
        async function saveGame(e) {
            e.preventDefault();
            const gameId = saveGameButton.dataset.gameId;
            const gameData = {
                title: gameTitleInput.value,
                platform: gamePlatformSelect.value,
                location: gameLocationSelect.value,
                status: gameStatusSelect.value,
                timestamp: new Date()
            };

            try {
                if (!currentUser) throw new Error("Anda harus masuk untuk menyimpan game.");
                if (gameId) {
                    // Update existing game
                    const gameRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/userGames`, gameId);
                    await updateDoc(gameRef, gameData);
                    showToast("Game berhasil diupdate!");
                } else {
                    // Add new game
                    const gamesCollection = collection(db, `artifacts/${appId}/users/${currentUser.uid}/userGames`);
                    await addDoc(gamesCollection, gameData);
                    showToast("Game berhasil ditambahkan!");
                }
                hideModal(gameModal);
            } catch (error) {
                console.error("Error saving game: ", error);
                showToast(`Gagal menyimpan game: ${error.message}`, true);
            }
        }
        
        async function handleBulkEditSubmit(e) {
            e.preventDefault();
            const updates = {};
            if (bulkEditPlatformSelect.value) { updates.platform = bulkEditPlatformSelect.value; }
            if (bulkEditLocationSelect.value) { updates.location = bulkEditLocationSelect.value; }
            if (bulkEditStatusSelect.value) { updates.status = bulkEditStatusSelect.value; }

            if (Object.keys(updates).length === 0) {
                showToast("Tidak ada perubahan yang dipilih.", true);
                return;
            }

            hideModal(bulkEditModal);
            showConfirm(`Apakah Anda yakin ingin mengedit ${selectedGameIds.size} game?`, async () => {
                await bulkEditGames(updates);
                hideModal(confirmModal);
            });
        }
        
        function exportData() {
            if (!allGames.length) {
                showToast("Tidak ada data untuk diekspor.", true);
                return;
            }
            const dataStr = JSON.stringify(allGames, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'game_collection.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast("Data berhasil diekspor.");
        }
        
        async function importData(file) {
            try {
                if (!currentUser) throw new Error("Anda harus masuk untuk mengimpor data.");
                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const importedGames = JSON.parse(event.target.result);
                        if (!Array.isArray(importedGames)) {
                            throw new Error("File JSON harus berisi sebuah array.");
                        }

                        // Use a custom modal for confirmation
                        showConfirm(`Anda akan mengimpor ${importedGames.length} game. Lanjutkan?`, async () => {
                            const batch = writeBatch(db);
                            const gamesCollection = collection(db, `artifacts/${appId}/users/${currentUser.uid}/userGames`);
                            importedGames.forEach(game => {
                                // Ensure data is valid before adding to batch
                                if (game.title && game.platform && game.location && game.status) {
                                    const newGameRef = doc(gamesCollection);
                                    batch.set(newGameRef, game);
                                }
                            });
                            await batch.commit();
                            showToast(`${importedGames.length} game berhasil diimpor.`);
                            hideModal(confirmModal);
                        });
                        
                    } catch (error) {
                        console.error("Error importing JSON: ", error);
                        showToast(`Gagal mengimpor: ${error.message}`, true);
                    } finally {
                        jsonFileInput.value = '';
                    }
                };
                reader.readAsText(file);
            } catch (error) {
                console.error("Error with file: ", error);
                showToast(`Gagal membaca file: ${error.message}`, true);
            }
        }
        
        async function initFirebaseAndAuth() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is missing.");
                    loginScreen.innerHTML = `<div class="w-full max-w-md bg-slate-800 rounded-2xl shadow-2xl p-8 text-center"><p class="text-red-400">Firebase config is missing. Please ensure your environment is set up correctly.</p></div>`;
                    return;
                }
                
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Sign in with custom token if available, otherwise anonymously
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Listen for auth state changes
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUser = user;
                        loginScreen.classList.add('hidden');
                        appScreen.classList.remove('hidden');
                        userName.textContent = user.displayName || "Guest User";
                        userIdElem.textContent = `ID: ${user.uid}`;
                        userPhoto.src = user.photoURL || "https://placehold.co/40x40/e2e8f0/e2e8f0";
                        setupRealtimeListener();
                    } else {
                        currentUser = null;
                        loginScreen.classList.remove('hidden');
                        appScreen.classList.add('hidden');
                    }
                });
            } catch (error) {
                console.error("Error initializing Firebase or authentication: ", error);
                showToast(`Gagal menginisialisasi aplikasi: ${error.message}`, true);
            }
        }

        // Event Listeners
        window.addEventListener('load', () => {
            initFirebaseAndAuth();
            setupTabListeners();
            populateFormOptions();
        });

        loginButton.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("Error during Google sign-in: ", error);
                showToast("Gagal masuk dengan Google.", true);
            }
        });

        logoutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
                showToast("Anda telah keluar.");
                allGames = [];
                filteredGames = [];
                selectedGameIds.clear();
                renderGameList([]);
                updateCharts();
            } catch (error) {
                console.error("Error during sign-out: ", error);
                showToast("Gagal keluar.", true);
            }
        });
        
        modalElements.forEach(modal => {
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal(modal);
                }
            });
        });

        cancelGameButton.addEventListener('click', () => hideModal(gameModal));
        cancelBulkEditButton.addEventListener('click', () => hideModal(bulkEditModal));
        cancelConfirmButton.addEventListener('click', () => hideModal(confirmModal));
        confirmActionButton.addEventListener('click', () => {
            if (currentConfirmAction) {
                currentConfirmAction();
            }
        });

        addGameButton.addEventListener('click', () => openGameModal());
        gameForm.addEventListener('submit', saveGame);
        bulkEditForm.addEventListener('submit', handleBulkEditSubmit);
        bulkEditButton.addEventListener('click', openBulkEditModal);

        bulkDeleteButton.addEventListener('click', () => {
            showConfirm(`Apakah Anda yakin ingin menghapus ${selectedGameIds.size} game? Tindakan ini tidak dapat diurungkan.`, async () => {
                await bulkDeleteGames();
                hideModal(confirmModal);
            });
        });
        
        selectAllCheckbox.addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            selectedGameIds.clear();
            document.querySelectorAll('.game-checkbox').forEach(checkbox => {
                checkbox.checked = isChecked;
                if (isChecked) {
                    selectedGameIds.add(checkbox.dataset.id);
                }
            });
            updateBulkButtons();
            updateSelectionInfo();
        });

        // Filter listeners
        filterTitleInput.addEventListener('input', () => { currentPage = 1; applyFiltersAndRender(); });
        filterPlatformSelect.addEventListener('change', () => { currentPage = 1; applyFiltersAndRender(); });
        filterLocationSelect.addEventListener('change', () => { currentPage = 1; applyFiltersAndRender(); });
        filterStatusSelect.addEventListener('change', () => { currentPage = 1; applyFiltersAndRender(); });
        
        downloadJsonButton.addEventListener('click', exportData);
        importJsonButton.addEventListener('click', () => jsonFileInput.click());
        jsonFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                fileNameSpan.textContent = file.name;
                importData(file);
            }
        });

        // Mobile sidebar listeners
        openSidebarButton.addEventListener('click', () => {
            sidebar.classList.remove('-translate-x-full');
            mobileMenuBackdrop.classList.remove('hidden');
        });
        closeSidebarButton.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            mobileMenuBackdrop.classList.add('hidden');
        });
        mobileMenuBackdrop.addEventListener('click', () => {
             sidebar.classList.add('-translate-x-full');
            mobileMenuBackdrop.classList.add('hidden');
        });
    </script>
</body>
</html>
